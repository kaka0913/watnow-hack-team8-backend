## 1. プロジェクト目標

本計画の目標は、ナビゲーションアプリ「BeFree」のコア機能を実現するため、対象エリア（大阪・京都・滋賀）における質の高いスポット情報（POI）を、Supabaseデータベースのpoisテーブルに投入することです。

## 2. 技術アーキテクチャ概要

- データ収集: Google Places API
    
- エリア分割: Geohash (精度6) を採用。約1.2km × 0.6kmの領域でエリアを分割し、効率的にスポットを探索します。
    
- データベース: Supabase (PostgreSQL + PostGIS)
    
- 実行環境: 開発者各自のローカルPC (Python)

## 3. 実行計画サマリー

### 推定総リクエスト数

- 約21,600〜24,000リクエスト
    

#### 計算式

総リクエスト数は、以下の式で概算されます。

総リクエスト数 ≈ (対象Geohash数) × (カテゴリ数) × (1カテゴリあたりの平均リクエスト数)

- 対象Geohash数: 約1,200〜1,300個
    

- 無料枠を最大限活用するため、対象エリアを下の「無料枠で実現する対象エリアの定義」に記載の主要都市部・観光エリアに限定した場合の数。
    

- カテゴリ数: 12個
    

- POI_TYPESリストに定義されているカテゴリの総数。
    

- 1カテゴリあたりの平均リクエスト数: 約1.5回
    

- Google Places APIは1回のリクエストで最大60件（3ページ分）までしか返しません。スポットが少ないカテゴリは1回で済みますが、多いカテゴリは2回以上のリクエストが必要になるため、平均を1.5回と仮定します。
    

計算例: 1,200 × 12 × 1.5 = 21,600 リクエスト

### 実行担当人数

- 4人での分担実行を推奨
    
- 4人で分担した場合、一人あたり約5,400リクエストを担当します。
    
- Googleの無料枠（$200）では約6,250リクエストまでカバーできるため、この計画で進めれば各自の無料枠内に収まる見込みです。
    

### 推定実行時間

- 各自 約2時間〜3時間
    
- 4人で分担した場合、一人あたりが担当するエリアは約300個です。APIの応答時間や待機時間を考慮すると、この程度の時間が見込まれます。
    
## 4. 【1人実行用】京都集中データ収集プラン

まずはアプリの魅力を最大限に発揮できる京都中心部に絞り、1人分の無料枠で質の高いデータを構築するためのプランです。

- **目的:** 最初のプロトタイプとして、最も魅力的なエリアで高密度のデータを構築する。
    
- **担当人数:** **1人**
    
- **予算:** **Google Cloud無料枠（$200）の範囲内**
    
- **総リクエスト数:** 約**5,940リクエスト** (330 Geohash × 12カテゴリ × 1.5回)
    
- **対象エリアとGeohash配分 (合計 約330個):**
    
    - **四条烏丸〜四条河原町（最優先）:** 約80個
        
    - **祇園〜東山エリア:** 約120個
        
    - **京都駅〜五条駅周辺:** 約50個
        
    - **嵐山・嵯峨野エリア:** 約80個
        
- **実行方法:**
    
    - スクリプト内の`TARGET_BOUNDING_BOXES = BOUNDING_BOXES_KABU`のコメントアウトを、解除してプログラムを実行

## 5. 無料枠で実現する対象エリアの定義

無料枠を最大限活用し、かつ魅力的なエリアをカバーするため、データ取得の対象を以下の主要エリアに限定します。これにより、対象Geohash数を合計で約1,250個に調整します。

### 京都府: 約500 Geohash

観光地が広範囲に点在しており、最も多くのGeohashを割り当てます。

- 中心市街地エリア (約250 Geohash):
    

    - 京都駅〜五条駅周辺: 約50 Geohash
        
    - 四条烏丸〜四条河原町: 約80 Geohash
        
    - 祇園〜東山（清水寺周辺含む）: 約120 Geohash
    

- 西部エリア (約150 Geohash):
    

    - 嵐山・嵯峨野: 約80 Geohash
        
    - 金閣寺・龍安寺・北野天満宮周辺: 約70 Geohash
    

- その他観光エリア (約100 Geohash):
    

    - 伏見稲荷大社周辺: 約50 Geohash
        
    - 下鴨神社・出町柳周辺: 約50 Geohash
        

### 大阪府: 約450 Geohash

スポットが非常に密集していますが、地理的には京都よりコンパクトなため、この数を割り当てます。

- キタエリア (約200 Geohash):
    

    - 梅田・大阪駅周辺: 約100 Geohash
        
    - 中崎町・天神橋筋商店街: 約50 Geohash
        
    - 福島・中之島: 約50 Geohash
    

- ミナミエリア (約150 Geohash):
    

    - 難波・道頓堀: 約80 Geohash
        
    - 心斎橋・アメリカ村: 約70 Geohash
    

- その他市街地エリア (約100 Geohash):
    

    - 天王寺・阿倍野・新世界: 約70 Geohash
        
    - 大阪城公園周辺: 約30 Geohash
        

### 滋賀県: 約300 Geohash

琵琶湖沿いの主要な都市部と観光地に絞ってカバーします。

- 南湖東岸エリア (約150 Geohash):
    

- 草津駅・南草津駅周辺: 約80 Geohash
    
- イオンモール草津・矢橋帰帆島公園周辺: 約70 Geohash
    

- 南湖西岸エリア (約150 Geohash):
    

- 大津駅・浜大津・びわ湖ホール周辺: 約80 Geohash
    
- 石山駅・石山寺周辺: 約70 Geohash. 


#### 【具体的な実装方法】

スクリプトを調整し、上記の各エリア（例：「京都府中心市街地エリア」）のバウンディングボックス（緯度経度の範囲）を複数定義します。スクリプト実行時に、それら全てのバウンディングボックスからGeohashを生成し、重複を除いた上で全体のGeohashリストを作成。そのリストを4分割して各担当者に割り振る、という流れで実装します。


#### 【補足】エリア同士の被りについて
この計画で各エリアに割り当てているGeohash数は、最低限必要な数よりも多めに設定されています。これは「贅沢なカバレッジ」であり、意図的なものです。

目的: データの「取りこぼし」を防ぎ、品質を向上させるためです。

仕組み: Geohashは円形で検索するため、隣り合う検索範囲が少しずつ重なり合います。この「かぶり」があることで、エリアの境界線ギリギリにある魅力的なスポットも確実にデータベースに収めることができます。

結果: 同じスポットが重複して登録されるわけではなく、より網羅的で密度の高いデータベースが完成します。



## 6. 実行ステップ

### Step 0: 環境構築 (全員)

各自のPCで、以下の環境構築を完了させてください。

1. Pythonのインストール: PCにPython 3.8以上がインストールされていることを確認します。
    
2. ライブラリのインストール: ターミナルで以下のコマンドを実行します。  
    pip install python-dotenv supabase requests shapely pygeohash  
      
    
3. .envファイルの作成:  
    スクリプトと同じ階層に.envファイルを作成し、各自のAPIキーを設定します。 
    ``` 
    SUPABASE_URL="YOUR_SUPABASE_URL"  
    SUPABASE_ANON_KEY="YOUR_SUPABASE_ANON_KEY"  
    GOOGLE_API_KEY="YOUR_GOOGLE_MAPS_API_KEY"  
    ```
      
    ※ GOOGLE_API_KEYは、Places APIが有効になっている必要があります。
    

### Step 1: データベース準備 (代表者1名)

### Step 2: データ投入の分割実行 (全員)

準備が整ったら、4人のメンバーが同時に、それぞれ自分のPCのターミナルで以下のコマンドを実行します。--partの番号が他の人と被らないように、自分の担当コマンドをコピー＆ペーストしてください。

#### 【〇〇さんの作業手順】
populate_pois.py スクリプトを開きます。

スクリプト上部の「エリア定義」セクションにある、自分の名前の行のコメントを外します（行頭の#を削除します）。
```
# TARGET_BOUNDING_BOXES = BOUNDING_BOXES_〇〇
```

スクリプトは、全エリアを4分割し、各自が担当するエリアのデータ収集を自動で開始。

### Step 3: 実行結果の確認 (全員)

スクリプト実行中、ターミナルに進捗が表示されます。また、SupabaseのTable Editorでpoisテーブルを開き、データがリアルタイムで追加されていく様子を確認できます。

## 7. 注意事項

- APIキー: .envファイルはGitなどのバージョン管理に含めないでください。
    
- 予算: この計画で進めれば、各自の無料枠を超えることはない見込みですが、念のためGoogle Cloudの予算アラート設定を推奨します。
    
- エラー: 実行中にエラーが発生した場合は、ターミナルのエラーメッセージをチームのチャットで共有してください。
    
