## 1. プロジェクト目標

本計画の目標は、ナビゲーションアプリ「BeFree」のコア機能を実現するため、対象エリア（大阪・京都・滋賀）における質の高いスポット情報（POI）を、Supabase データベースの pois テーブルに投入することです。

## 2. 技術アーキテクチャ概要

- データ収集: Google Places API
- エリア分割: Geohash (精度 6) を採用。約 1.2km × 0.6km の領域でエリアを分割し、効率的にスポットを探索します。
- データベース: Supabase (PostgreSQL + PostGIS)
- 実行環境: 開発者各自のローカル PC (Python)

## 3. 実行計画サマリー

### 推定総リクエスト数

- 約 21,600〜24,000 リクエスト

#### 計算式

総リクエスト数は、以下の式で概算されます。

総リクエスト数 ≈ (対象 Geohash 数) × (カテゴリ数) × (1 カテゴリあたりの平均リクエスト数)

- 対象 Geohash 数: 約 1,200〜1,300 個

- 無料枠を最大限活用するため、対象エリアを下の「無料枠で実現する対象エリアの定義」に記載の主要都市部・観光エリアに限定した場合の数。

- カテゴリ数: 12 個

- POI_TYPES リストに定義されているカテゴリの総数。

- 1 カテゴリあたりの平均リクエスト数: 約 1.5 回

- Google Places API は 1 回のリクエストで最大 60 件（3 ページ分）までしか返しません。スポットが少ないカテゴリは 1 回で済みますが、多いカテゴリは 2 回以上のリクエストが必要になるため、平均を 1.5 回と仮定します。

計算例: 1,200 × 12 × 1.5 = 21,600 リクエスト

### 実行担当人数

- 4 人での分担実行を推奨
- 4 人で分担した場合、一人あたり約 5,400 リクエストを担当します。
- Google の無料枠（$200）では約 6,250 リクエストまでカバーできるため、この計画で進めれば各自の無料枠内に収まる見込みです。

### 推定実行時間

- 各自 約 2 時間〜3 時間
- 4 人で分担した場合、一人あたりが担当するエリアは約 300 個です。API の応答時間や待機時間を考慮すると、この程度の時間が見込まれます。

## 4. 【1 人実行用】京都集中データ収集プラン

まずはアプリの魅力を最大限に発揮できる京都中心部に絞り、1 人分の無料枠で質の高いデータを構築するためのプランです。

- **目的:** 最初のプロトタイプとして、最も魅力的なエリアで高密度のデータを構築する。
- **担当人数:** **1 人**
- **予算:** **Google Cloud 無料枠（$200）の範囲内**
- **総リクエスト数:** 約**5,940 リクエスト** (330 Geohash × 12 カテゴリ × 1.5 回)
- **対象エリアと Geohash 配分 (合計 約 330 個):**
  - **四条烏丸〜四条河原町（最優先）:** 約 80 個
  - **祇園〜東山エリア:** 約 120 個
  - **京都駅〜五条駅周辺:** 約 50 個
  - **嵐山・嵯峨野エリア:** 約 80 個
- **実行方法:**
  - スクリプト内の`TARGET_BOUNDING_BOXES = BOUNDING_BOXES_KABU`のコメントアウトを、解除してプログラムを実行

## 5. 無料枠で実現する対象エリアの定義

無料枠を最大限活用し、かつ魅力的なエリアをカバーするため、データ取得の対象を以下の主要エリアに限定します。これにより、対象 Geohash 数を合計で約 1,250 個に調整します。

### 京都府: 約 500 Geohash

観光地が広範囲に点在しており、最も多くの Geohash を割り当てます。

- 中心市街地エリア (約 250 Geohash):

  - 京都駅〜五条駅周辺: 約 50 Geohash
  - 四条烏丸〜四条河原町: 約 80 Geohash
  - 祇園〜東山（清水寺周辺含む）: 約 120 Geohash

- 西部エリア (約 150 Geohash):

  - 嵐山・嵯峨野: 約 80 Geohash
  - 金閣寺・龍安寺・北野天満宮周辺: 約 70 Geohash

- その他観光エリア (約 100 Geohash):

  - 伏見稲荷大社周辺: 約 50 Geohash
  - 下鴨神社・出町柳周辺: 約 50 Geohash

### 大阪府: 約 450 Geohash

スポットが非常に密集していますが、地理的には京都よりコンパクトなため、この数を割り当てます。

- キタエリア (約 200 Geohash):

  - 梅田・大阪駅周辺: 約 100 Geohash
  - 中崎町・天神橋筋商店街: 約 50 Geohash
  - 福島・中之島: 約 50 Geohash

- ミナミエリア (約 150 Geohash):

  - 難波・道頓堀: 約 80 Geohash
  - 心斎橋・アメリカ村: 約 70 Geohash

- その他市街地エリア (約 100 Geohash):

  - 天王寺・阿倍野・新世界: 約 70 Geohash
  - 大阪城公園周辺: 約 30 Geohash

### 滋賀県: 約 300 Geohash

琵琶湖沿いの主要な都市部と観光地に絞ってカバーします。

- 南湖東岸エリア (約 150 Geohash):

    - 草津駅・南草津駅周辺: 約80 Geohash
    - イオンモール草津・矢橋帰帆島公園周辺: 約70 Geohash
    

- 南湖西岸エリア (約150 Geohash):
    

    - 大津駅・浜大津・びわ湖ホール周辺: 約80 Geohash
    - 石山駅・石山寺周辺: 約70 Geohash

#### 【具体的な実装方法】

スクリプトを調整し、上記の各エリア（例：「京都府中心市街地エリア」）のバウンディングボックス（緯度経度の範囲）を複数定義します。スクリプト実行時に、それら全てのバウンディングボックスから Geohash を生成し、重複を除いた上で全体の Geohash リストを作成。そのリストを 4 分割して各担当者に割り振る、という流れで実装します。

#### 【補足】エリア同士の被りについて

この計画で各エリアに割り当てている Geohash 数は、最低限必要な数よりも多めに設定されています。これは「贅沢なカバレッジ」であり、意図的なものです。

目的: データの「取りこぼし」を防ぎ、品質を向上させるためです。

仕組み: Geohash は円形で検索するため、隣り合う検索範囲が少しずつ重なり合います。この「かぶり」があることで、エリアの境界線ギリギリにある魅力的なスポットも確実にデータベースに収めることができます。

結果: 同じスポットが重複して登録されるわけではなく、より網羅的で密度の高いデータベースが完成します。

## 6. 実行ステップ

### Step 0: 環境構築 (全員)

各自の PC で、以下の環境構築を完了させてください。

1. Python のインストール: PC に Python 3.8 以上がインストールされていることを確認します。
2. ライブラリのインストール: ターミナルで以下のコマンドを実行します。  
   pip install python-dotenv supabase requests shapely pygeohash
3. .env ファイルの作成:  
   スクリプトと同じ階層に.env ファイルを作成し、各自の API キーを設定します。
   ```
   SUPABASE_URL="YOUR_SUPABASE_URL"
   SUPABASE_ANON_KEY="YOUR_SUPABASE_ANON_KEY"
   GOOGLE_MAPS_API_KEY="YOUR_GOOGLE_MAPS_API_KEY"
   ```
   ※ GOOGLE_MAPS_API_KEY は、Places API が有効になっている必要があります。

### Step 1: データベース準備 (代表者 1 名)

### Step 2: データ投入の分割実行 (全員)

準備が整ったら、4 人のメンバーが同時に、それぞれ自分の PC のターミナルで以下のコマンドを実行します。--part の番号が他の人と被らないように、自分の担当コマンドをコピー＆ペーストしてください。

#### 【〇〇さんの作業手順】

populate_pois.py スクリプトを開きます。

スクリプト上部の「エリア定義」セクションにある、自分の名前の行のコメントを外します（行頭の#を削除します）。

```
# TARGET_BOUNDING_BOXES = BOUNDING_BOXES_〇〇
```

スクリプトは、全エリアを 4 分割し、各自が担当するエリアのデータ収集を自動で開始。

### Step 3: 実行結果の確認 (全員)

スクリプト実行中、ターミナルに進捗が表示されます。また、Supabase の Table Editor で pois テーブルを開き、データがリアルタイムで追加されていく様子を確認できます。

## 7. 注意事項

- API キー: .env ファイルは Git などのバージョン管理に含めないでください。
- 予算: この計画で進めれば、各自の無料枠を超えることはない見込みですが、念のため Google Cloud の予算アラート設定を推奨します。
- エラー: 実行中にエラーが発生した場合は、ターミナルのエラーメッセージをチームのチャットで共有してください。
